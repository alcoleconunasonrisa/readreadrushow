<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lectura de S√≠labas con Sonido</title>
    <link href="https://fonts.googleapis.com/css2?family=Andika&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Andika', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #fff5e6; margin: 0; overflow: hidden; }
        .card { background: white; padding: 40px; border-radius: 30px; text-align: center; border: 4px solid #ffcc00; width: 350px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        #silaba { font-size: 160px; color: #2c3e50; margin: 10px 0; font-weight: bold; transition: 0.3s; }
        #feedback { font-size: 1.2rem; margin-bottom: 20px; color: #666; min-height: 2.5em; }
        .btn-start { background: #ff6b6b; color: white; padding: 15px 40px; border: none; border-radius: 50px; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 0 #ee5253; }
        .btn-start:active { transform: translateY(4px); box-shadow: none; }
        .correcto { color: #27ae60 !important; transform: scale(1.1); }
        .error-anim { animation: shake 0.3s; color: #e74c3c !important; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

    <div class="card">
        <div id="feedback">¬°Pulsa el bot√≥n para empezar!</div>
        <div id="silaba">?</div>
        <button id="btn" class="btn-start">¬°Empezar!</button>
    </div>

    <script>
        const silabasBase = ["ma", "me", "mi", "mo", "mu"];
        const ayudas = {
            "mu": ["mu", "muy", "mue", "mucho", "u", "boom"],
            "mi": ["mi", "m√≠", "mis", "miedo"],
            "mo": ["mo", "no", "more", "mon"], 
            "ma": ["ma", "m√°s", "mal", "amar"],
            "me": ["me", "mes", "mi", "met"]
        };

        let silabasMezcladas = [];
        let indice = 0;
        let activo = false;

        const silabaDiv = document.getElementById('silaba');
        const feedbackDiv = document.getElementById('feedback');
        const btn = document.getElementById('btn');

        // --- SISTEMA DE SONIDO (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const sonidoAcierto = () => playTone(600, 'sine', 0.3);
        const sonidoError = () => playTone(150, 'triangle', 0.3);
        const sonidoVictoria = () => {
            playTone(523.25, 'sine', 0.2);
            setTimeout(() => playTone(659.25, 'sine', 0.2), 150);
            setTimeout(() => playTone(783.99, 'sine', 0.4), 300);
        };

        // --- RECONOCIMIENTO DE VOZ ---
        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const rec = Recognition ? new Recognition() : null;

        if (rec) {
            rec.lang = 'es-ES';
            rec.continuous = true;
            rec.onend = () => { if (activo) rec.start(); };

            rec.onresult = (e) => {
                const transcript = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
                const objetivo = silabasMezcladas[indice];
                
                const acierto = ayudas[objetivo].some(p => transcript.includes(p));

                if (acierto) {
                    sonidoAcierto();
                    procesarAcierto();
                } else {
                    sonidoError();
                    silabaDiv.classList.add('error-anim');
                    feedbackDiv.innerHTML = `He o√≠do "${transcript}"... <br>¬°Prueba otra vez!`;
                    setTimeout(() => silabaDiv.classList.remove('error-anim'), 400);
                }
            };
        }

        function procesarAcierto() {
            silabaDiv.classList.add('correcto');
            feedbackDiv.innerHTML = "<b>¬°Muy bien!</b> ‚ú®";
            setTimeout(() => {
                indice++;
                if (indice >= silabasMezcladas.length) {
                    finalizarJuego();
                } else {
                    actualizarPantalla();
                }
            }, 1000);
        }

        function actualizarPantalla() {
            silabaDiv.textContent = silabasMezcladas[indice];
            silabaDiv.classList.remove('correcto');
            feedbackDiv.textContent = "D√≠ la s√≠laba: " + silabasMezcladas[indice];
        }

        function finalizarJuego() {
            activo = false;
            rec.stop();
            sonidoVictoria();
            silabaDiv.textContent = "üèÜ";
            feedbackDiv.innerHTML = "<b>¬°Eres un campe√≥n/a!</b>";
            btn.style.display = 'inline-block';
            btn.textContent = "Volver a jugar";
        }

        btn.onclick = () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            silabasMezcladas = [...silabasBase].sort(() => Math.random() - 0.5);
            indice = 0;
            activo = true;
            btn.style.display = 'none';
            actualizarPantalla();
            rec.start();
        };
    </script>
</body>
</html>
