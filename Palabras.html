<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lectura de Palabras con Iconos</title>
    <link href="https://fonts.googleapis.com/css2?family=Andika&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Andika', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #fff5e6; margin: 0; overflow: hidden; }
        .card { background: white; padding: 30px; border-radius: 30px; text-align: center; border: 4px solid #ffcc00; width: 400px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        .image-container { 
            width: 100%; 
            height: 220px; 
            margin-bottom: 15px; 
            border-radius: 20px; 
            background: #f9f9f9; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border: 2px solid #f0f0f0;
            font-size: 120px; 
        }
        
        #silaba { font-size: 70px; color: #2c3e50; margin: 10px 0; font-weight: bold; transition: 0.3s; text-transform: lowercase; }
        #feedback { font-size: 1.2rem; margin-bottom: 20px; color: #666; min-height: 2.5em; }
        .btn-start { background: #ff6b6b; color: white; padding: 15px 40px; border: none; border-radius: 50px; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 0 #ee5253; }
        .btn-start:active { transform: translateY(4px); box-shadow: none; }
        .correcto { color: #27ae60 !important; transform: scale(1.1); }
        .error-anim { animation: shake 0.3s; color: #e74c3c !important; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

    <div class="card">
        <div id="feedback">¬°Pulsa el bot√≥n para empezar!</div>
        <div class="image-container" id="visual-container">
            <span id="icono-dibujo">üìñ</span>
        </div>
        <div id="silaba">?</div>
        <button id="btn" class="btn-start">¬°Empezar!</button>
    </div>

    <script>
        // Lista corregida: Solo s√≠labas directas (C+V) y sin trabadas
        const palabrasBase = [
            // General
            { palabra: "tomate", icono: "üçÖ" },
            { palabra: "maleta", icono: "üß≥" },
            { palabra: "pelota", icono: "‚öΩ" },
            { palabra: "casa", icono: "üè†" },
            { palabra: "mono", icono: "üêí" },
            { palabra: "pato", icono: "ü¶Ü" },
            { palabra: "mesa", icono: "üñºÔ∏è" }, // Cambiado a un marco/mesa plana para evitar la silla
            { palabra: "mapa", icono: "üó∫Ô∏è" },
            // Naturaleza (Solo s√≠labas directas)
            { palabra: "pino", icono: "üå≤" },
            { palabra: "nube", icono: "‚òÅÔ∏è" },
            { palabra: "rosa", icono: "üåπ" },
            { palabra: "rana", icono: "üê∏" },
            { palabra: "luna", icono: "üåô" },
            { palabra: "lobo", icono: "üê∫" }
        ];

        let palabrasMezcladas = [];
        let indice = 0;
        let activo = false;

        const silabaDiv = document.getElementById('silaba');
        const feedbackDiv = document.getElementById('feedback');
        const btn = document.getElementById('btn');
        const iconoDibujo = document.getElementById('icono-dibujo');

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const sonidoAcierto = () => playTone(600, 'sine', 0.3);
        const sonidoError = () => playTone(150, 'triangle', 0.3);
        const sonidoVictoria = () => {
            playTone(523.25, 'sine', 0.2);
            setTimeout(() => playTone(659.25, 'sine', 0.2), 150);
            setTimeout(() => playTone(783.99, 'sine', 0.4), 300);
        };

        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const rec = Recognition ? new Recognition() : null;

        if (rec) {
            rec.lang = 'es-ES';
            rec.continuous = true;
            rec.onend = () => { if (activo) rec.start(); };

            rec.onresult = (e) => {
                const transcript = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
                const objetivo = palabrasMezcladas[indice].palabra;
                
                if (transcript.includes(objetivo)) {
                    sonidoAcierto();
                    procesarAcierto();
                } else {
                    sonidoError();
                    silabaDiv.classList.add('error-anim');
                    feedbackDiv.innerHTML = `He o√≠do "${transcript}"... <br>¬°Int√©ntalo de nuevo!`;
                    setTimeout(() => silabaDiv.classList.remove('error-anim'), 400);
                }
            };
        }

        function procesarAcierto() {
            silabaDiv.classList.add('correcto');
            feedbackDiv.innerHTML = "<b>¬°Muy bien hecho!</b> ‚ú®";
            setTimeout(() => {
                indice++;
                if (indice >= palabrasMezcladas.length) {
                    finalizarJuego();
                } else {
                    actualizarPantalla();
                }
            }, 1200);
        }

        function actualizarPantalla() {
            const itemActual = palabrasMezcladas[indice];
            silabaDiv.textContent = itemActual.palabra;
            silabaDiv.classList.remove('correcto');
            feedbackDiv.textContent = "D√≠ la palabra:";
            iconoDibujo.textContent = itemActual.icono;
        }

        function finalizarJuego() {
            activo = false;
            if(rec) rec.stop();
            sonidoVictoria();
            silabaDiv.textContent = "üèÜ";
            iconoDibujo.textContent = "ü•á";
            feedbackDiv.innerHTML = "<b>¬°Felicidades, terminaste!</b>";
            btn.style.display = 'inline-block';
            btn.textContent = "Jugar otra vez";
        }

        btn.onclick = () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            palabrasMezcladas = [...palabrasBase].sort(() => Math.random() - 0.5);
            indice = 0;
            activo = true;
            btn.style.display = 'none';
            actualizarPantalla();
            if(rec) rec.start();
        };
    </script>
</body>
</html>
