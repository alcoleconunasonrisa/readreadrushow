<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lectura de S√≠labas - M, L, S, T</title>
    <link href="https://fonts.googleapis.com/css2?family=Andika&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Andika', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #fff5e6; margin: 0; overflow: hidden; }
        .card { background: white; padding: 40px; border-radius: 30px; text-align: center; border: 4px solid #ffcc00; width: 400px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); position: relative; }
        
        #selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        
        #silaba { font-size: 160px; color: #2c3e50; margin: 10px 0; font-weight: bold; transition: 0.3s; display: none; }
        #feedback { font-size: 1.2rem; margin-bottom: 20px; color: #666; min-height: 2.5em; }
        
        .btn-start { background: #ff6b6b; color: white; padding: 15px; border: none; border-radius: 20px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 0 #ee5253; transition: 0.2s; }
        .btn-start:active { transform: translateY(4px); box-shadow: none; }
        .btn-mix { background: #4ecdc4; box-shadow: 0 4px 0 #45b7af; grid-column: span 2; }
        
        .btn-home { position: absolute; top: -60px; left: 50%; transform: translateX(-50%); background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 15px; text-decoration: none; font-size: 1rem; box-shadow: 0 4px 0 #2980b9; }

        .correcto { color: #27ae60 !important; transform: scale(1.1); }
        .error-anim { animation: shake 0.3s; color: #e74c3c !important; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

    <div class="card">
        <a href="main-index.html" class="btn-home">üè† Volver al Inicio</a>

        <div id="feedback">¬øQu√© letra quieres practicar?</div>
        
        <div id="silaba">?</div>
        
        <div id="selector">
            <button class="btn-start" onclick="iniciarJuego('m')">Letra M</button>
            <button class="btn-start" onclick="iniciarJuego('l')">Letra L</button>
            <button class="btn-start" onclick="iniciarJuego('s')">Letra S</button>
            <button class="btn-start" onclick="iniciarJuego('t')">Letra T</button>
            <button class="btn-start btn-mix" onclick="iniciarJuego('mix')">Mezclar Todas</button>
        </div>
    </div>

    <script>
        const silabasData = {
            "m": ["ma", "me", "mi", "mo", "mu"],
            "l": ["la", "le", "li", "lo", "lu"],
            "s": ["sa", "se", "si", "so", "su"],
            "t": ["ta", "te", "ti", "to", "tu"]
        };

        const ayudas = {
            "ma": ["ma", "m√°s", "mar"], "me": ["me", "mes"], "mi": ["mi", "m√≠"], "mo": ["mo", "mon"], "mu": ["mu", "muy"],
            "la": ["la", "las", "al"], "le": ["le", "les", "el"], "li": ["li", "lupa"], "lo": ["lo", "los"], "lu": ["lu", "luz"],
            "sa": ["sa", "sal", "san"], "se": ["se", "ser", "s√©"], "si": ["si", "s√≠", "sin"], "so": ["so", "son", "sol"], "su": ["su", "sur"],
            "ta": ["ta", "tan", "tal"], "te": ["te", "ten", "t√©"], "ti": ["ti", "t√≠o", "ti-"], "to": ["to", "tos", "top"], "tu": ["tu", "tus", "t√∫"]
        };

        let silabasMezcladas = [];
        let indice = 0;
        let activo = false;

        const silabaDiv = document.getElementById('silaba');
        const feedbackDiv = document.getElementById('feedback');
        const selectorDiv = document.getElementById('selector');

        // --- SISTEMA DE SONIDO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }
        const sonidoAcierto = () => playTone(600, 'sine', 0.3);
        const sonidoError = () => playTone(150, 'triangle', 0.3);
        const sonidoVictoria = () => {
            playTone(523.25, 'sine', 0.2);
            setTimeout(() => playTone(659.25, 'sine', 0.2), 150);
            setTimeout(() => playTone(783.99, 'sine', 0.4), 300);
        };

        // --- RECONOCIMIENTO DE VOZ ---
        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const rec = Recognition ? new Recognition() : null;

        if (rec) {
            rec.lang = 'es-ES';
            rec.continuous = true;
            rec.onend = () => { if (activo) rec.start(); };
            rec.onresult = (e) => {
                const transcript = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
                const objetivo = silabasMezcladas[indice];
                const acierto = ayudas[objetivo].some(p => transcript.includes(p));

                if (acierto) {
                    sonidoAcierto();
                    procesarAcierto();
                } else {
                    sonidoError();
                    silabaDiv.classList.add('error-anim');
                    feedbackDiv.innerHTML = `He o√≠do "${transcript}"... <br>¬°Prueba otra vez!`;
                    setTimeout(() => silabaDiv.classList.remove('error-anim'), 400);
                }
            };
        }

        function iniciarJuego(modo) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            if (modo === 'mix') {
                silabasMezcladas = [...silabasData.m, ...silabasData.l, ...silabasData.s, ...silabasData.t];
            } else {
                silabasMezcladas = [...silabasData[modo]];
            }

            silabasMezcladas.sort(() => Math.random() - 0.5);
            indice = 0;
            activo = true;
            
            selectorDiv.style.display = 'none';
            silabaDiv.style.display = 'block';
            actualizarPantalla();
            if(rec) rec.start();
        }

        function procesarAcierto() {
            silabaDiv.classList.add('correcto');
            feedbackDiv.innerHTML = "<b>¬°Muy bien!</b> ‚ú®";
            setTimeout(() => {
                indice++;
                if (indice >= silabasMezcladas.length) {
                    finalizarJuego();
                } else {
                    actualizarPantalla();
                }
            }, 1000);
        }

        function actualizarPantalla() {
            silabaDiv.textContent = silabasMezcladas[indice];
            silabaDiv.classList.remove('correcto');
            feedbackDiv.textContent = "D√≠ la s√≠laba: " + silabasMezcladas[indice];
        }

        function finalizarJuego() {
            activo = false;
            if(rec) rec.stop();
            sonidoVictoria();
            silabaDiv.textContent = "üèÜ";
            feedbackDiv.innerHTML = "<b>¬°Excelente trabajo!</b>";
            setTimeout(() => {
                silabaDiv.style.display = 'none';
                selectorDiv.style.display = 'grid';
                feedbackDiv.textContent = "¬øQuieres probar con otra letra?";
            }, 3000);
        }
    </script>
</body>
</html>
